# 开发环境 Dockerfile
FROM golang:1.21-alpine AS development

WORKDIR /app

# 安装必要的工具
RUN apk add --no-cache git ca-certificates tzdata

# 复制依赖文件
COPY go.mod go.sum ./
RUN go mod download

# 复制源代码
COPY . .

# 构建应用
RUN go build -o bin/alertbot cmd/server/main.go
RUN go build -o bin/migrate cmd/migrate/main.go

# 运行迁移并启动服务
CMD ["sh", "-c", "./bin/migrate && ./bin/alertbot"]

EXPOSE 8080